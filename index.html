<!DOCTYPE html>
<html lang="en-US">
    <head>
        <title>odoc</title>
        <style>
            * {
                font-family: Arial, Helvetica, sans-serif;
            }
            body {
                background-color: #0043ab;
                overflow: hidden;
            }
            .desktop {
                color: white;
            }
            .taskbar {
                background-color: #d6d7dc;
                width: 100%;
                height: 7%;
                position: absolute;
                bottom: 0%;
                left: 0%;
            }
            .taskbar-main-start {
                outline-width: 0px;
                border-width: 0px;
                background-color: rgba(255,255,255,50%);
                height: 100%;
                width: 8%;
                font-size: 200%;
            }
            .taskbar-main-timeanddate {
                position: absolute;
                top: 0%;
                right: 1%;
            }
            .desktop-icon {
                color: white;
                width: 7%;
                float: left;
                background-color: transparent;
                outline-width: 0px;
                border-width: 0px;
                /*position: absolute;*/
            }
            .desktop-icon-text {
                text-align: center;
            }
            .computer-window {
                color: black;
                background-color: white;
                outline-style: outset;
                outline-color: blue;
                outline-width: 5px;
                position: absolute;
            }
            .computer-window-topbar {
                color: white;
                background-color: blue;
            }
            .computer-window-topbar-closeButton {
                color: white;
                width: 64px;
                height: 64px;
                float: right;
                background-color: red;
                outline-color: white;
                border-color: white;
                text-align: center;
                font-size: 300%;
            }
            .computer-window-topbar-moveButton {
                color: white;
                width: 64px;
                height: 64px;
                float: right;
                background-color: #ffaa00;
                outline-color: white;
                border-color: white;
                text-align: center;
                font-size: 300%;
            }
            .computer-window-topbar-metadata {
                display: flex;
                vertical-align: middle;
            }
            .computer-window-content-div {
                overflow: hidden;
            }
            .computer-window-userFiles-tableElement {
                height: 3em;
                overflow: auto;
            }
        </style>
    </head>
    <body>
        <!--<p id="debug_log" style="color:white"></p>-->
        <div class="desktop" id="desktop">
        </div>
        <div class="taskbar" id="taskbar">
            <button type="input" class="taskbar-main-start" id="taskbar_main_start">start</button>
            <p class="taskbar-main-timeanddate" id="taskbar_timeanddate"></p>
        </div>
        <script>
            const params = new URLSearchParams(document.location.search);
            if (params.has("blob")) {
                const html = "<!DOCTYPE html><html lang=\"en-US\">" + document.documentElement.innerHTML + "</html>"
                const blob = new Blob([html], {
                    type: "text/html"
                })
                window.location.href = window.URL.createObjectURL(blob)
            }
            let mouseX = 0
            let mouseY = 0
            window.onmousemove = (e) => {
                mouseX = e.clientX
                mouseY = e.clientY
            }
            const mouseUpEvents = []
            const registeredPrograms = []
            window.onmouseup = () => {
                mouseUpEvents.forEach(event => {
                    event()
                })
            }
            function unixToDate(unix) {
                return (new Date(unix).toDateString() + ", " + new Date(unix).toLocaleTimeString())
            }
            /*setInterval(() => {
                document.getElementById("debug_log").innerHTML = mouseX + " " + mouseY
            }, 1)*/
            setInterval(() => {
                document.getElementById("taskbar_timeanddate").innerHTML = unixToDate(new Date().getTime())
            }, 1000)
            // style functions
            function positionToStyle(x, y, offset) {
                return "left:" + (x - (offset ? offset : 0)) + "px;top:" + (y - (offset ? offset : 0)) + "px"
            }
            // program functions
            const desktop = document.getElementById("desktop")
            function createProgram(name, image, onOpen) {
                const icon = document.createElement("button")
                icon.name = "desktop_icon"
                const desktopIconID = Math.round(Math.random() * 999999999)
                icon.id = "desktop_icon_" + desktopIconID
                icon.setAttribute("class", "desktop-icon")
                const iconImage = document.createElement("img")
                iconImage.draggable = false
                iconImage.width = 100
                iconImage.height = 100
                iconImage.src = image
                icon.append(iconImage)
                const iconDescriptor = document.createElement("p")
                iconDescriptor.setAttribute("class", "desktop-icon-text")
                iconDescriptor.innerHTML = name
                icon.append(iconDescriptor)
                desktop.append(icon)
                icon.onclick = () => {
                    if (onOpen != null) onOpen(desktopIconID, name, image)
                }
                registeredPrograms.push({name: name, image: image, onOpen: onOpen})
            }
            function createWindow(data) {
                const win = document.createElement("div")
                win.setAttribute("class", "computer-window")
                desktop.append(win)
                win.setAttribute("width", String(data.width == null ? 0 : data.width))
                win.setAttribute("height", String(data.height == null ? 0 : data.height))
                win.setAttribute("x", "20")
                win.setAttribute("y", "20")
                function render() {
                    win.setAttribute("style", "width:" + win.getAttribute("width") + "px;height:" + win.getAttribute("height") + "px;left:" + win.getAttribute("x") + "px;top:" + win.getAttribute("y") + "px")
                }
                win.render = render
                function setPosition(x, y) {
                    win.setAttribute("x", String(x))
                    win.setAttribute("y", String(y))
                    render()
                }
                win.setPosition = setPosition
                win.close = () => {
                    win.remove()
                }
                render()
                if (!data.notopbar) {
                    const topbar = document.createElement("div")
                    topbar.setAttribute("class", "computer-window-topbar")
                    topbar.innerHTML = "<div class=\"computer-window-topbar-metadata\"><img src=\"" + data.icon + "\" width=\"64\" height=\"64\"><p>" + data.title + "</p></div>"
                    if (!data.noMoving) {
                        let isMoving = false
                        const moveButton = document.createElement("button")
                        moveButton.setAttribute("class", "computer-window-topbar-moveButton")
                        moveButton.innerHTML = "O"
                        topbar.prepend(moveButton)
                        let moveInterval = null
                        moveButton.onclick = () => {
                            if (!isMoving) {
                                isMoving = true
                                moveInterval = setInterval(() => {
                                    setPosition(mouseX - (data.width - (data.noCloseButton == true ? 30 : 90)), mouseY - 30)
                                }, 10)
                                if (win.onstartmove) win.onstartmove()
                            } else {
                                isMoving = false
                                clearInterval(moveInterval)
                                if (win.onendmove) win.onendmove()
                            }
                        }
                        
                    }
                    if (!data.noCloseButton) {
                        const closeButton = document.createElement("button")
                        closeButton.setAttribute("class", "computer-window-topbar-closeButton")
                        closeButton.innerHTML = "X"
                        topbar.prepend(closeButton)
                        closeButton.onclick = () => {
                            if (!win.onclose) {
                                showError("This program has no onclose function", true)
                                win.close()
                            } else {
                                win.onclose()
                            }
                        }
                    }
                    win.append(topbar)
                }
                const contentDiv = document.createElement("div")
                contentDiv.setAttribute("class", "computer-window-content-div")
                win.content = contentDiv
                win.append(contentDiv)
                return win
            }
            function showError(message, playSound) {
                const errwin = createWindow({
                    title: "Error",
                    icon: "./assets/icons/error.png",
                    width: 640,
                    height: 220
                })
                errwin.onclose = () => {
                    errwin.close()
                }
                errwin.content.innerHTML = "<div style=\"text-align:center;\"><br><img src=\"./assets/icons/error.png\" width=\"75\" height=\"75\"><p>" + message + "</p></div>"
                console.error(message)
                if (playSound) {
                    const audio = new Audio("https://cdn.discordapp.com/attachments/914411539887456296/1016924505098178620/criticalstop.wav")
                    audio.play()
                }
            }
            function showInfo(message) {
                const errwin = createWindow({
                    title: "Info",
                    icon: "./assets/icons/info.png",
                    width: 640,
                    height: 220
                })
                errwin.onclose = () => {
                    errwin.close()
                }
                errwin.content.innerHTML = "<div style=\"text-align:center;\"><br><img src=\"./assets/icons/info.png\" width=\"75\" height=\"75\"><p>" + message + "</p></div>"
                console.info(message)
            }
            function showWarning(message, playSound, buttonToExit, buttonText) {
                const warningWindow = createWindow({
                    title: "Warning",
                    icon: "./assets/icons/warning.png",
                    noCloseButton: buttonToExit,
                    width: 640,
                    height: 220 + (buttonToExit ? 100 : 0)
                })
                warningWindow.onclose = () => {
                    warningWindow.close()
                }
                warningWindow.content.innerHTML = "<div style=\"text-align:center;\"><br><img src=\"./assets/icons/warning.png\" width=\"75\" height=\"75\"><p>" + message + "</p></div>"
                console.warn(message)
                if (buttonToExit) {
                    warningWindow.content.append(document.createElement("br"))
                    warningWindow.content.append(document.createElement("br"))
                    const centerDiv = document.createElement("div")
                    centerDiv.setAttribute("style", "text-align:center")
                    const exitButton = document.createElement("input")
                    exitButton.type = "submit"
                    exitButton.value = (buttonText != null ? buttonText : "OK")
                    exitButton.onclick = () => {
                        warningWindow.onclose()
                    }
                    centerDiv.append(exitButton)
                    warningWindow.content.append(centerDiv)
                }
                if (playSound) {
                    const audio = new Audio("https://cdn.discordapp.com/attachments/914411539887456296/1017285867787796521/ding.wav")
                    audio.play()
                }
            }
            // create programs
            createProgram("user", "./assets/icons/userfolder.png", function(id, name, image) {
                const w = createWindow({
                    title: name,
                    icon: image,
                    width: 1280,
                    height: 720
                })
                w.onclose = () => {
                    w.close()
                }
                const programsLabel = document.createElement("h1")
                programsLabel.innerHTML = "Registered programs"
                w.content.append(programsLabel)
                registeredPrograms.forEach(program => {
                    const button = document.createElement("button")
                    button.type = "submit"
                    button.innerHTML = "<img src=\"" + String(program.image) + "\" width=\"64\" height=\"64\"><p>" + String(program.name).replace(/</gmi, "&lt;") + "</p>"
                    button.onclick = () => {
                        program.onOpen(null, program.name, program.image)
                    }
                    w.content.append(button)
                })
                w.content.append(document.createElement("br"))
                w.content.append(document.createElement("br"))
                const storageLabel = document.createElement("h1")
                storageLabel.innerHTML = "Computer storage"
                w.content.append(storageLabel)
                const details = document.createElement("details")
                details.setAttribute("style", "height:20em;overflow:auto")
                const summary = document.createElement("summary")
                summary.innerHTML = "View localStorage"
                details.append(summary)
                const refreshLocalStorageButton = document.createElement("input")
                refreshLocalStorageButton.value = "↺"
                refreshLocalStorageButton.title = "Refresh localStorage"
                refreshLocalStorageButton.type = "submit"
                details.append(refreshLocalStorageButton)
                w.content.append(details)
                const table = document.createElement("table")
                function resetTable(table) {
                    table.innerHTML = "<tr><th>Key</th><th>Value</th></tr>"
                    for (let i = 0; localStorage.key(i) != null; i++) {
                        const tr = document.createElement("tr")
                        tr.innerHTML = "<td><code>" + String(localStorage.key(i)).replace(/</gmi, "&lt;").replace(/\n/gmi, "<br>") + "</code></td><td><div class=\"computer-window-userFiles-tableElement\"><code>" + String(localStorage.getItem(localStorage.key(i))).replace(/</gmi, "&lt;").replace(/\n/gmi, "<br>") + "</code></div></td>"
                        table.append(tr)
                    }
                }
                resetTable(table)
                refreshLocalStorageButton.onclick = () => {
                    resetTable(table)
                }
                details.append(table)
            })
            createProgram("notepad", "./assets/icons/notepad.png", function(id, name, image) {
                const w = createWindow({
                    title: name,
                    icon: image,
                    width: 720,
                    height: 720
                })
                const textarea = document.createElement("textarea")
                w.onclose = () => {
                    localStorage.setItem("NOTEPAD_string", textarea.value)
                    w.close()
                }
                textarea.setAttribute("style", "width:100%;height:49em")
                w.content.append(textarea)
                const str = localStorage.getItem("NOTEPAD_string")
                if (str) textarea.value = str
            })
            createProgram(
                "webframe",
                "./assets/icons/webframe.png",
                function(id, name, image) {
                    const w = createWindow({
                        title: name,
                        icon: image,
                        width: 1280,
                        height: 720
                    })
                    w.onclose = () => {
                        w.close()
                    }
                    if (!localStorage.getItem("WEBFRAME_history")) localStorage.setItem("WEBFRAME_history", "[]")
                    const infobar = document.createElement("div")
                    infobar.setAttribute("style", "width:100%;background-color:gray;height:1.6em;color:white")
                    /*
                    const backButton = document.createElement("input")
                    backButton.title = "Go back a page"
                    backButton.type = "submit"
                    backButton.value = "⏪"
                    infobar.append(backButton)
                    const forwardButton = document.createElement("input")
                    forwardButton.title = "Go to the page you went back from"
                    forwardButton.type = "submit"
                    forwardButton.value = "⏩"
                    infobar.append(forwardButton)
                    */
                    const refreshButton = document.createElement("input")
                    refreshButton.title = "Refresh this page"
                    refreshButton.type = "submit"
                    refreshButton.value = "🔄"
                    infobar.append(refreshButton)
                    const searchBar = document.createElement("input")
                    searchBar.title = "Search for something"
                    searchBar.type = "text"
                    searchBar.size = 110
                    infobar.append(searchBar)
                    const searchButton = document.createElement("input")
                    searchButton.title = "Search"
                    searchButton.type = "submit"
                    searchButton.value = "🔍"
                    infobar.append(searchButton)
                    const shareButton = document.createElement("input")
                    shareButton.title = "Copy this website link"
                    shareButton.type = "submit"
                    shareButton.value = "📩"
                    infobar.append(shareButton)
                    const history = document.createElement("input")
                    history.title = "View your search history"
                    history.type = "submit"
                    history.value = "🕑"
                    infobar.append(history)
                    const homeButton = document.createElement("input")
                    homeButton.title = "Go to home page"
                    homeButton.type = "submit"
                    homeButton.value = "🏠"
                    infobar.append(homeButton)
                    const searchingHandlerSelector = document.createElement("select")
                    searchingHandlerSelector.title = "Switch searching handler"
                    infobar.append(searchingHandlerSelector)
                    searchingHandlerSelector.onchange = () => {
                        if (searchingHandlerSelector.value != "fetchhtml") return
                        showWarning("Enabling this will inject this page with the target website's HTML content. If you didn't understand that or you know that this is unsafe, switch the option back to iFrame or Fetch: Blob.", true, true, "I understand the dangers of this")
                    }
                    const handlerIframeOption = document.createElement("option")
                    handlerIframeOption.innerHTML = "iFrame"
                    handlerIframeOption.value = "iframe"
                    searchingHandlerSelector.append(handlerIframeOption)
                    const handlerFetchOption = document.createElement("option")
                    handlerFetchOption.innerHTML = "Fetch: Blob"
                    handlerFetchOption.value = "fetch"
                    searchingHandlerSelector.append(handlerFetchOption)
                    const handlerFetchHTMLOption = document.createElement("option")
                    handlerFetchHTMLOption.innerHTML = "Fetch: HTML"
                    handlerFetchHTMLOption.value = "fetchhtml"
                    searchingHandlerSelector.append(handlerFetchHTMLOption)
                    const handlerFetchBlobTabOption = document.createElement("option")
                    handlerFetchBlobTabOption.innerHTML = "Fetch: Blob (new tab)"
                    handlerFetchBlobTabOption.value = "fetchblobtab"
                    searchingHandlerSelector.append(handlerFetchBlobTabOption)
                    const setHeadersButton = document.createElement("input")
                    setHeadersButton.title = "Set headers for the request"
                    setHeadersButton.type = "submit"
                    setHeadersButton.value = "💿"
                    infobar.append(setHeadersButton)
                    let headers = {}
                    if (!localStorage.getItem("WEBFRAME_REQUEST_headers")) {
                        localStorage.setItem("WEBFRAME_REQUEST_headers", JSON.stringify(headers))
                    }
                    setHeadersButton.onclick = () => {
                        const hw = createWindow({
                            title: "webframe - set headers",
                            icon: image,
                            noCloseButton: true,
                            width: 500,
                            height: 500
                        })
                        setHeadersButton.setAttribute("style", "display:none")
                        const finishedButton = document.createElement("input")
                        finishedButton.value = "Finished"
                        finishedButton.type = "submit"
                        hw.content.setAttribute("style", "text-align:center")
                        hw.content.append(document.createElement("br"))
                        hw.content.append(finishedButton)
                        hw.content.append(document.createElement("br"))
                        hw.content.append(document.createElement("br"))
                        const headerTextBox = document.createElement("textarea")
                        headerTextBox.setAttribute("style", "width:80%;height:25em")
                        hw.content.append(headerTextBox)
                        finishedButton.onclick = () => {
                            let newHeaders = null
                            try {
                                newHeaders = JSON.parse(headerTextBox.value)
                            } catch (err) {
                                showError("Invalid Header JSON; " + err, true)
                                return
                            }
                            headers = newHeaders
                            localStorage.setItem("WEBFRAME_REQUEST_headers", JSON.stringify(headers))
                            hw.close()
                            setHeadersButton.removeAttribute("style")
                        }
                        headerTextBox.value = localStorage.getItem("WEBFRAME_REQUEST_headers")
                    }
                    w.content.append(infobar)
                    const webframe = document.createElement("iframe")
                    webframe.setAttribute("samesite", "none")
                    webframe.setAttribute("secure", true)
                    webframe.setAttribute("sandbox", "allow-scripts allow-popups allow-forms allow-same-origin allow-popups-to-escape-sandbox allow-downloads")
                    let fetchhtmlDiv
                    function loadWebpage(url) {
                        webframe.setAttribute("style", "width:100%;height:39em")
                        if (fetchhtmlDiv) {
                            fetchhtmlDiv.remove()
                            fetchhtmlDiv = null
                        }
                        const isUsingFetch = searchingHandlerSelector.value == "fetch" || searchingHandlerSelector.value == "fetchhtml" || searchingHandlerSelector.value == "fetchblobtab"
                        if (isUsingFetch == true) {
                            const blob = new Blob(["<p>Fetching page, please wait...</p>"], {
                                type: "text/html"
                            })
                            webframe.src = window.URL.createObjectURL(blob)
                            fetch(String(url), {
                                headers: headers
                            }).then(response => {
                                const format = searchingHandlerSelector.value == "fetch" ? "blob" : "html"
                                const promise = (format == "blob" ? response.blob() : response.text())
                                promise.then(sanitized => {
                                    let blob = sanitized
                                    if (searchingHandlerSelector.value == "fetchhtml") {
                                        webframe.setAttribute("style", "display:none")
                                        fetchhtmlDiv = document.createElement("div")
                                        w.content.append(fetchhtmlDiv)
                                        fetchhtmlDiv.innerHTML = sanitized
                                    } else if (searchingHandlerSelector.value == "fetchblobtab") {
                                        let newWindow = window.open('/')
                                        const blob = new Blob([sanitized], {
                                            type: response.headers.get("Content-Type")
                                        })
                                        const url = window.URL.createObjectURL(blob)
                                        newWindow.location = url
                                    } else {
                                        webframe.src = window.URL.createObjectURL(blob)
                                    }
                            }).catch(err => {
                                const blob = new Blob(["<p>An error occurred: " + err + "</p>"], {
                                    type: "text/html"
                                })
                                webframe.src = window.URL.createObjectURL(blob)
                            })}).catch(err => {
                                const blob = new Blob(["<p>An error occurred: " + err + "</p>"], {
                                    type: "text/html"
                                })
                                webframe.src = window.URL.createObjectURL(blob)
                            })
                        } else {
                            if (Object.getOwnPropertyNames(headers).length > 0) {
                                const blob = new Blob(["<br><br><p style=\"text-align:center;font-size:200%\"><b>For headers you are required to use the \"Fetch: Blob\" or \"Fetch: HTML\" search type next to the Home button in the dropdown.</b></p>"], {
                                    type: "text/html"
                                })
                                webframe.src = window.URL.createObjectURL(blob)
                            } else {
                                webframe.src = url
                            }
                        }
                        searchBar.value = url
                        const historyArray = JSON.parse(localStorage.getItem("WEBFRAME_history"))
                        historyArray.push({url: url, date: new Date().getTime()})
                        localStorage.setItem("WEBFRAME_history", JSON.stringify(historyArray))
                    }
                    loadWebpage("https://bing.com")
                    searchBar.onsubmit = () => {
                        if (String(searchBar.value) == "wf:history") {
                            history.onclick()
                            return
                        }
                        if (!(String(searchBar.value).includes(".") || String(searchBar.value).includes("/"))) {
                            searchBar.value = "https://www.bing.com/search?q=" + encodeURIComponent(searchBar.value)
                            loadWebpage(searchBar.value)
                            return
                        }
                        if (!(String(searchBar.value).match(/http(s|):\/\//))) searchBar.value = "https://" + searchBar.value
                        loadWebpage(searchBar.value)
                    }
                    searchBar.onkeypress = (e) => {
                        if (e.keyCode == 13) searchBar.onsubmit()
                    }
                    searchButton.onclick = searchBar.onsubmit
                    refreshButton.onclick = searchBar.onsubmit
                    shareButton.onclick = () => {
                        navigator.clipboard.writeText(String(searchBar.value))
                    }
                    homeButton.onclick = () => {
                        loadWebpage("https://bing.com")
                    }
                    history.onclick = () => {
                        let html = ""
                        const historyArray = JSON.parse(localStorage.getItem("WEBFRAME_history"))
                        historyArray.forEach(memory => {
                            html = "<p>" + memory.url + " - <i>" + unixToDate(memory.date) + "</i></p>" + html
                        })
                        html = "<h1>Search history</h1><br>" + html
                        const blob = new Blob([html], {
                            type: "text/html"
                        })
                        loadWebpage(window.URL.createObjectURL(blob))
                        searchBar.value = "wf:history"
                    }
                    w.content.append(webframe)
                }
            )
            createProgram("executor", "./assets/icons/executor.png", function(id, name, image) {
                const w = createWindow({
                    title: name,
                    icon: image,
                    width: 1280,
                    height: 720
                })
                const textarea = document.createElement("textarea")
                let tabs = []
                let currentTabKey = "prg1"
                function save() {
                    localStorage.setItem("EXECUTOR_" + currentTabKey, textarea.value)
                    localStorage.setItem("EXECUTOR_tabs", JSON.stringify(tabs))
                }
                function load() {
                    const script = localStorage.getItem("EXECUTOR_" + currentTabKey)
                    if (script) {
                        textarea.value = script
                    } else {
                        textarea.value = ""
                    }
                }
                w.onclose = () => {
                    save()
                    w.close()
                }
                const codeTabDiv = document.createElement("div")
                tabs.push({key: currentTabKey})
                if (!localStorage.getItem("EXECUTOR_tabs")) {
                    localStorage.setItem("EXECUTOR_tabs", JSON.stringify(tabs))
                } else {
                    const newTabs = JSON.parse(localStorage.getItem("EXECUTOR_tabs"))
                    tabs = newTabs
                }
                function resetTabs() {
                    codeTabDiv.innerHTML = ""
                    let i = 1
                    tabs.forEach(tab => {
                        let index = i
                        const openTabButton = document.createElement("button")
                        openTabButton.type = "submit"
                        openTabButton.innerHTML = "Program " + i + " "
                        openTabButton.onclick = () => {
                            save()
                            currentTabKey = "prg" + index
                            load()
                        }
                        codeTabDiv.append(openTabButton)
                        const closeTabButton = document.createElement("input")
                        closeTabButton.type = "submit"
                        closeTabButton.value = "X"
                        openTabButton.append(closeTabButton)
                        closeTabButton.onclick = () => {
                            tabs.splice(tabs.indexOf(currentTabKey), 1)
                            resetTabs()
                            save()
                            currentTabKey = "prg1"
                            load()
                        }
                        if (i == 1) closeTabButton.remove()
                        i++
                    })
                    const addNewTabButton = document.createElement("input")
                    addNewTabButton.type = "submit"
                    addNewTabButton.value = "+"
                    codeTabDiv.append(addNewTabButton)
                    addNewTabButton.onclick = () => {
                        const key = "prg" + (tabs.length + 1)
                        tabs.push({key: key})
                        currentTabKey = key
                        load()
                        resetTabs()
                    }
                }
                resetTabs()
                load()
                w.content.append(codeTabDiv)
                textarea.setAttribute("style", "width:100%;height:44em")
                textarea.placeholder = "odoc.showInfo('Hello world!')"
                w.content.append(textarea)
                const runButton = document.createElement("button")
                runButton.innerHTML = "▶"
                runButton.setAttribute("style", "background-color:green;color:white;width:100%;height:3em")
                w.content.append(runButton)
                // create the odoc dependency
                const odoc = {}
                odoc.showError = showError
                odoc.showWarning = showWarning
                odoc.showInfo = showInfo
                odoc.createWindow = createWindow
                odoc.createProgram = createProgram
                // programStorage
                // const programStorage = {cache: {}}
                // programStorage.keys = []
                // programStorage.setItem = (key, value) => {
                //     localStorage.setItem("EXECUTOR_PROGRAMSTORAGE_" + key, value)
                //     programStorage.cache[String(key)] = value
                //     if (!programStorage.keys.includes(key)) programStorage.keys.push(key)
                // }
                // handle run button stuff
                runButton.onclick = () => {
                    try {
                        eval(textarea.value)
                    } catch (err) {
                        showError(err, true)
                    }
                }
                //const str = localStorage.getItem("NOTEPAD_string")
                //if (str) textarea.value = str
            })
            // dragging desktop icons
            /*
            const desktopicons = document.getElementsByName("desktop_icon")
            for (let i = 0; i < desktopicons.length; i++) {
                const icon = desktopicons.item(i)
                let iconBeingClicked = false
                icon.onclick = () => {
                    iconBeingClicked = true
                }
                mouseUpEvents.push(() => { iconBeingClicked = false })
                setInterval(() => {
                    if (iconBeingClicked) { icon.setAttribute("style", positionToStyle(mouseX, mouseY, 50)) }
                }, 10)
            }
            */
        </script>
    </body>
</html>